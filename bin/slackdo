#!/usr/bin/env ruby

require 'slackdo'

config = Slackdo::Config.new
config.configure_init

banner = <<-EOS
Usage: slackdo [options] <subcommands> 
Where [options] are: 
    - configure <subcommand> | slack, trello
    - category <subcommand> | add, remove
    - label <subcommand> | add, remove
    - disable <subcommand> | trello
    - enable <subcommand> | trello
    - task
    - reminder
EOS

case ARGV[0]
	when 'help', '-h', '--help'
	  puts banner
	when 'configure'
	  config.configure_slack_webhook if ARGV[1] == 'slack'
	  config.configure_trello_api if ARGV[1] == 'trello' && ARGV[2].nil?
	when 'category'
	  config.add_category if ARGV[1] == 'add'
	  config.remove_category if ARGV[1] == 'remove'
	when 'label'
	  config.add_label if ARGV[1] == 'add'
	  config.remove_label if ARGV[1] == 'remove'
	when 'disable'
	  config.disable_trello if ARGV[1] == 'trello'
	when 'enable'
      config.enable_trello if ARGV[1] == 'trello'
	when 'task'
	  slack = Slackdo::Task.new
      slack.add_task
	  file = File.read("#{ENV['HOME']}/.slackdo/config.json")
      hash = JSON.parse(file)
	  if hash['allow_trello_pushing'] == 'true'
		card_name = slack.get_message
		card_desc = slack.get_notes
		card_category = slack.get_category
		trello = Slackdo::Card.new
	    trello.add_card(card_category, card_name, card_desc)
	  end
	when 'reminder'
	  slack = Slackdo::Reminder.new
	  slack.add_reminder
    end
